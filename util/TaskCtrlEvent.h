/****************************************************************************/
/*                                                                          */
/*                                                                          */
/*                                 GRUNDFOS                                 */
/*                           DK-8850 BJERRINGBRO                            */
/*                                 DENMARK                                  */
/*               --------------------------------------------               */
/*                Project: MPC                                              */
/*               --------------------------------------------               */
/*                                                                          */
/*               (C) Copyright Grundfos                                     */
/*               All rights reserved                                        */
/*               --------------------------------------------               */
/*                                                                          */
/*               As this is the  property of  GRUNDFOS  it                  */
/*               must not be passed on to any person not aut-               */
/*               horized  by GRUNDFOS or be  copied or other-               */
/*               wise  utilized by anybody without GRUNDFOS'                */
/*               expressed written permission.                              */
/****************************************************************************/
/* CLASS NAME       : TaskCtrlEvent                                         */
/*                                                                          */
/* FILE NAME        : TaskCtrlEvent.h                                       */
/*                                                                          */
/* CREATED DATE     : 21-09-2004  (dd-mm-yyyy)                              */
/*                                                                          */
/* SHORT FILE DESCRIPTION : Class specification TaskCtrlEvent               */
/****************************************************************************/

/*****************************************************************************
   Protect against multiple inclusion through the use of guards:
 ****************************************************************************/
#ifndef mpcTaskCtrlEvent_h
#define mpcTaskCtrlEvent_h

/*****************************************************************************
  SYSTEM INCLUDES
 *****************************************************************************/

/*****************************************************************************
  PROJECT INCLUDES
 *****************************************************************************/
#include <cu351_cpu_types.h>
#include <fifo.h>
#include <SubTask.h>
#include <rtos.h>

/*****************************************************************************
  LOCAL INCLUDES
 ****************************************************************************/

/*****************************************************************************
  DEFINES
 *****************************************************************************/

/*****************************************************************************
  TYPE DEFINES
 *****************************************************************************/

class SubTask;
/*****************************************************************************
 * CLASS:
 * DESCRIPTION:
 *
 *****************************************************************************/
class TaskCtrlEvent : public TaskCtrl
{
  public:
    /********************************************************************
    LIFECYCLE - Default constructor.
    ********************************************************************/
    TaskCtrlEvent(void);

    /********************************************************************
    LIFECYCLE - Destructor.
    ********************************************************************/
    ~TaskCtrlEvent(void);

    /********************************************************************
    ASSIGNMENT OPERATORS
    ********************************************************************/

    /********************************************************************
    OPERATIONS
    ********************************************************************/
    void RunSubTasks(void);
    void ReqRun(SubTask*);
    void InitSubTasks(void);            // Overrides base class function

  private:
    /********************************************************************
    OPERATIONS
    ********************************************************************/

    /********************************************************************
    ATTRIBUTES
    ********************************************************************/
    /* The task queue size must be large enough to contain all events that 
    can be added simultaneously. The size was once measured and it needs 
    to be at least 202 during start up. 
    If the queue is full events will be lost and some subtasks may 
    never be called afterwards if the mRunRequestedFlag-mechanism is used! */
    Fifo<SubTask*, 250> mSubTaskQueue; 
    OS_RSEMA mSemaSubTaskQueue;

  protected:
    /********************************************************************
    OPERATIONS
    ********************************************************************/

    /********************************************************************
    ATTRIBUTE
    ********************************************************************/
};
#endif
